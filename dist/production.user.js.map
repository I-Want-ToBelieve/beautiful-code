{"version":3,"file":"production.user.js","sources":["../src/index.ts"],"sourcesContent":["import VM from '@violentmonkey/dom'\nimport { ModelOperations } from '@vscode/vscode-languagedetection'\nimport prettier from 'prettier'\nimport shiki from 'shiki'\n\n/**\n * @see https://github.com/microsoft/vscode-languagedetection#usage\n * @see https://github.com/microsoft/vscode/blob/3a1cf8e51e3797a2d9ccb12d207378de364596c4/src/vs/workbench/services/languageDetection/browser/languageDetectionService.ts#L59\n * @see https://unpkg.com/browse/@vscode/vscode-languagedetection@1.0.21/model/\n */\nconst modulOperations = new ModelOperations({\n  async modelJsonLoaderFunc () {\n    const response = await fetch(\n      'https://unpkg.com/@vscode/vscode-languagedetection@1.0.21/model/model.json'\n    )\n\n    const modelJSON = (await response.json()) as Record<string, any>\n    return modelJSON\n  },\n  async weightsLoaderFunc () {\n    const response = await fetch(\n      'https://unpkg.com/@vscode/vscode-languagedetection@1.0.21/model/group1-shard1of1.bin'\n    )\n    const buffer = await response.arrayBuffer()\n    return buffer\n  },\n})\n\n/**\n * @see https://github.com/shikijs/shiki/blob/main/docs/languages.md#all-languages\n * [\n    {\n        \"languageId\": \"js\",\n        \"confidence\": 0.24262011051177979\n    },\n    {\n        \"languageId\": \"groovy\",\n        \"confidence\": 0.2068355679512024\n    },\n    {\n        \"languageId\": \"coffee\",\n        \"confidence\": 0.08538007736206055\n    },\n    {\n        \"languageId\": \"ts\",\n        \"confidence\": 0.07805327326059341\n    },\n    {\n        \"languageId\": \"lua\",\n        \"confidence\": 0.04159870371222496\n    },\n    {\n        \"languageId\": \"rb\",\n        \"confidence\": 0.03658360242843628\n    },\n    {\n        \"languageId\": \"r\",\n        \"confidence\": 0.03136871010065079\n    },\n    {\n        \"languageId\": \"swift\",\n        \"confidence\": 0.02843020297586918\n    },\n    {\n        \"languageId\": \"dart\",\n        \"confidence\": 0.025191379711031914\n    },\n    {\n        \"languageId\": \"php\",\n        \"confidence\": 0.02489558607339859\n    },\n    {\n        \"languageId\": \"scala\",\n        \"confidence\": 0.016375916078686714\n    },\n    {\n        \"languageId\": \"py\",\n        \"confidence\": 0.01570715941488743\n    },\n    {\n        \"languageId\": \"kt\",\n        \"confidence\": 0.014793860726058483\n    },\n    {\n        \"languageId\": \"cs\",\n        \"confidence\": 0.010329823940992355\n    },\n    {\n        \"languageId\": \"ps1\",\n        \"confidence\": 0.009833300486207008\n    },\n    {\n        \"languageId\": \"html\",\n        \"confidence\": 0.009663671255111694\n    },\n    {\n        \"languageId\": \"f90\",\n        \"confidence\": 0.00893926527351141\n    },\n    {\n        \"languageId\": \"json\",\n        \"confidence\": 0.008335321210324764\n    },\n    {\n        \"languageId\": \"mm\",\n        \"confidence\": 0.008064116351306438\n    },\n    {\n        \"languageId\": \"matlab\",\n        \"confidence\": 0.0077512627467513084\n    },\n    {\n        \"languageId\": \"md\",\n        \"confidence\": 0.007669923361390829\n    },\n    {\n        \"languageId\": \"java\",\n        \"confidence\": 0.006278263870626688\n    },\n    {\n        \"languageId\": \"clj\",\n        \"confidence\": 0.00619084807112813\n    },\n    {\n        \"languageId\": \"cpp\",\n        \"confidence\": 0.005193199031054974\n    },\n    {\n        \"languageId\": \"ex\",\n        \"confidence\": 0.004912080243229866\n    },\n    {\n        \"languageId\": \"cmake\",\n        \"confidence\": 0.004895167890936136\n    },\n    {\n        \"languageId\": \"rs\",\n        \"confidence\": 0.004293493460863829\n    },\n    {\n        \"languageId\": \"tex\",\n        \"confidence\": 0.0040983883664011955\n    },\n    {\n        \"languageId\": \"prolog\",\n        \"confidence\": 0.003859680611640215\n    },\n    {\n        \"languageId\": \"csv\",\n        \"confidence\": 0.0037101071793586016\n    },\n    {\n        \"languageId\": \"dm\",\n        \"confidence\": 0.003579826094210148\n    },\n    {\n        \"languageId\": \"c\",\n        \"confidence\": 0.003512203460559249\n    },\n    {\n        \"languageId\": \"jl\",\n        \"confidence\": 0.003408814314752817\n    },\n    {\n        \"languageId\": \"sql\",\n        \"confidence\": 0.002867681672796607\n    },\n    {\n        \"languageId\": \"css\",\n        \"confidence\": 0.002399126533418894\n    },\n    {\n        \"languageId\": \"bat\",\n        \"confidence\": 0.002297078724950552\n    },\n    {\n        \"languageId\": \"vba\",\n        \"confidence\": 0.002262661000713706\n    },\n    {\n        \"languageId\": \"go\",\n        \"confidence\": 0.002190779196098447\n    },\n    {\n        \"languageId\": \"ini\",\n        \"confidence\": 0.002004046691581607\n    },\n    {\n        \"languageId\": \"ml\",\n        \"confidence\": 0.001782393315806985\n    },\n    {\n        \"languageId\": \"erl\",\n        \"confidence\": 0.0016315156826749444\n    },\n    {\n        \"languageId\": \"xml\",\n        \"confidence\": 0.0015882366569712758\n    },\n    {\n        \"languageId\": \"pas\",\n        \"confidence\": 0.001484898617491126\n    },\n    {\n        \"languageId\": \"pm\",\n        \"confidence\": 0.0014668531948700547\n    },\n    {\n        \"languageId\": \"hs\",\n        \"confidence\": 0.0009900418808683753\n    },\n    {\n        \"languageId\": \"yaml\",\n        \"confidence\": 0.0007946646073833108\n    },\n    {\n        \"languageId\": \"asm\",\n        \"confidence\": 0.000721517251804471\n    },\n    {\n        \"languageId\": \"sh\",\n        \"confidence\": 0.0007181295077316463\n    },\n    {\n        \"languageId\": \"lisp\",\n        \"confidence\": 0.0006713239708915353\n    },\n    {\n        \"languageId\": \"cbl\",\n        \"confidence\": 0.0005515082157216966\n    },\n    {\n        \"languageId\": \"dockerfile\",\n        \"confidence\": 0.0005290511180646718\n    },\n    {\n        \"languageId\": \"makefile\",\n        \"confidence\": 0.0002923230640590191\n    },\n    {\n        \"languageId\": \"v\",\n        \"confidence\": 0.00028496066806837916\n    },\n    {\n        \"languageId\": \"toml\",\n        \"confidence\": 0.000118325486255344\n    }\n]\n */\nconst langMap = new Map([['kt', 'kotlin']])\n\n/**\n * @see https://github.com/shikijs/shiki#usage\n * @see https://github.com/shikijs/shiki/blob/main/docs/languages.md#all-languages\n */\nconst highlight = () => {\n  void shiki\n    .getHighlighter({\n      langs: [...shiki.BUNDLED_LANGUAGES],\n      theme: 'dracula',\n    })\n    .then((highlighter) => {\n      // eslint-disable-next-line promise/no-nesting\n      void Promise.all(\n        Array.from(document.querySelectorAll('pre')).map(async (pre) => {\n          if (pre.dataset.isHighlighted === 'true') return void 0\n\n          const rawCodeText = pre.textContent ?? ''\n          const result = await modulOperations.runModel(rawCodeText)\n          const lang = result.at(0)?.languageId ?? 'tsx'\n\n          const code = highlighter.codeToHtml(\n            (() => {\n              try {\n                /**\n                 * @see https://prettier.io/docs/en/browser.html#global\n                 */\n                return prettier.format(rawCodeText, {\n                  parser: 'babel-ts',\n                  plugins: (window as any).prettierPlugins,\n                  semi: false,\n                  trailingComma: 'all',\n                  singleQuote: true,\n                  arrowParens: 'always',\n                  endOfLine: 'lf',\n                })\n              } catch {\n                return rawCodeText\n              }\n            })(),\n            { lang: langMap.get(lang) ?? lang }\n          )\n\n          /**\n           * @see https://stackoverflow.com/a/67571022/11791657\n           */\n          const range = document.createRange()\n          const fragment = range.createContextualFragment(\n            code\n              .replace(\n                'class=\"shiki\"',\n                () => 'class=\"shiki notranslate\" data-is-highlighted=\"true\"'\n              )\n              .replace('<code>', () => '<code style=\"background-color: transparent\">')\n          )\n          pre.replaceWith(fragment)\n        })\n      ).catch((err) => {\n        console.error(err)\n      })\n    })\n}\n\n/**\n * @see https://violentmonkey.github.io/guide/observing-dom/\n */\nVM.observe(document.body, () => {\n  highlight()\n\n  return false\n})\n"],"names":["ModelOperations","shiki","prettier","VM"],"mappings":"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"}